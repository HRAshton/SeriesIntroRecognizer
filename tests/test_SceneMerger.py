from scenedetect import FrameTimecode

from src import find_concurrent_scenes_merge, Scene

frame_rate = 23.976023976023978


def test_find_concurrent_scenes_merge():
    testdata = get_test_data()

    result = find_concurrent_scenes_merge(testdata)

    assert len(result) == 1
    assert result[0][0].start.frame_num == 1027
    assert result[0][0].end.frame_num == 3165
    assert result[0][1].start.frame_num == 2465
    assert result[0][1].end.frame_num == 4603


def get_test_data():
    groups = [
        (0, 71, 6311, 6359), (0, 71, 9561, 9585), (0, 71, 14515, 14637), (0, 71, 14820, 15054), (0, 71, 15159, 15210),
        (0, 71, 15503, 15572), (0, 71, 16067, 16203), (324, 572, 6311, 6359), (324, 572, 9561, 9585),
        (324, 572, 14515, 14637), (324, 572, 14820, 15054), (324, 572, 15159, 15210), (324, 572, 15503, 15572),
        (324, 572, 16067, 16203), (1027, 1061, 2465, 2499), (1061, 1084, 2499, 2522), (1084, 1114, 2522, 2552),
        (1114, 1143, 2552, 2581), (1143, 1177, 2581, 2615), (1177, 1235, 2615, 2673), (1235, 1261, 2673, 2699),
        (1261, 1360, 2699, 2798), (1360, 1469, 2798, 2907), (1469, 1490, 2907, 2928), (1490, 1611, 2928, 3049),
        (1611, 1713, 3049, 3151), (1713, 1743, 3151, 3181), (1743, 1758, 3181, 3196), (1758, 1775, 3196, 3213),
        (1775, 1791, 3213, 3229), (1791, 1807, 3229, 3245), (1807, 1823, 3245, 3261), (1823, 1844, 3261, 3282),
        (1844, 1873, 3282, 3311), (1873, 1902, 3311, 3340), (1902, 1952, 3340, 3390), (1952, 1999, 3390, 3419),
        (1999, 2064, 3437, 3502), (2064, 2139, 3502, 3577), (2139, 2154, 3577, 3592), (2154, 2197, 3592, 3635),
        (2197, 2215, 3635, 3653), (2215, 2230, 3653, 3668), (2230, 2249, 3668, 3687), (2249, 2264, 3687, 3702),
        (2264, 2279, 3702, 3717), (2279, 2301, 3717, 3739), (2301, 2317, 3739, 3755), (2317, 2337, 3755, 3775),
        (2337, 2352, 3775, 3790), (2352, 2368, 3790, 3806), (2368, 2383, 3806, 3821), (2383, 2401, 3821, 3839),
        (2401, 2417, 3839, 3855), (2417, 2433, 3855, 3871), (2433, 2460, 3871, 3898), (2460, 2515, 3898, 3953),
        (2515, 2531, 3953, 3969), (2531, 2547, 3969, 3985), (2547, 2617, 3985, 4055), (2617, 2644, 4055, 4082),
        (2644, 2677, 4082, 4115), (2677, 2695, 4115, 4133), (2695, 2727, 4133, 4165), (2727, 2743, 4165, 4181),
        (2743, 2763, 4181, 4201), (2763, 2787, 4201, 4225), (2787, 2803, 4225, 4241), (2803, 2827, 4241, 4265),
        (2827, 2842, 4265, 4280), (2842, 2860, 4280, 4298), (2860, 2902, 4298, 4340), (2902, 2917, 4340, 4355),
        (2917, 2935, 4355, 4373), (2935, 3020, 4373, 4458), (3020, 3082, 4458, 4520), (3082, 3110, 4520, 4548),
        (3110, 3165, 4548, 4603), (9152, 9202, 6311, 6359), (9152, 9202, 9561, 9585), (9152, 9202, 14515, 14637),
        (9152, 9202, 14820, 15054), (9152, 9202, 15159, 15210), (9152, 9202, 15503, 15572), (9152, 9202, 16067, 16203),
        (10025, 10055, 6311, 6359), (10025, 10055, 9561, 9585), (10025, 10055, 14515, 14637),
        (10025, 10055, 14820, 15054), (10025, 10055, 15159, 15210), (10025, 10055, 15503, 15572),
        (10025, 10055, 16067, 16203), (12663, 12696, 6311, 6359), (12663, 12696, 9561, 9585),
        (12663, 12696, 14515, 14637), (12663, 12696, 14820, 15054), (12663, 12696, 15159, 15210),
        (12663, 12696, 15503, 15572), (12663, 12696, 16067, 16203), (12739, 12847, 6311, 6359),
        (12739, 12847, 9561, 9585), (12739, 12847, 14515, 14637), (12739, 12847, 14820, 15054),
        (12739, 12847, 15159, 15210), (12739, 12847, 15503, 15572), (12739, 12847, 16067, 16203)
    ]

    similar_scenes = []
    for group in groups:
        similar_scenes.append((Scene(FrameTimecode(group[0], frame_rate),
                                     FrameTimecode(group[1], frame_rate)),
                               Scene(FrameTimecode(group[2], frame_rate),
                                     FrameTimecode(group[3], frame_rate))))

    return similar_scenes
